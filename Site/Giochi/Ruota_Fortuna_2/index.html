<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ruota Nomi & Nazioni</title>
    <link
      rel="icon"
      href="https://tse1.mm.bing.net/th/id/OIP.r4_dGgrMCMaLVk-yNrGQDAHaH6?rs=1&pid=ImgDetMain&o=7&rm=3"
      type="image/jpg"
    />
    <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #8b5cf6;
  --primary-dark: #7c3aed;
  --secondary: #06b6d4;
  --accent: #f59e0b;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #3b82f6;
  --dark: #0f172a;
  --glass: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glow: rgba(139, 92, 246, 0.4);
  --text: white;
}

body {
  font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
  min-height: 100vh;
  color: white;
  overflow-x: hidden;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 40% 60%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
}

.floating-orbs {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: -1;
}

.orb {
  position: absolute;
  border-radius: 50%;
  opacity: 0.1;
  animation: float 20s infinite ease-in-out;
}

.orb:nth-child(1) {
  width: 200px;
  height: 200px;
  background: radial-gradient(circle, var(--primary), transparent);
  top: 10%;
  left: 10%;
  animation-delay: 0s;
}

.orb:nth-child(2) {
  width: 150px;
  height: 150px;
  background: radial-gradient(circle, var(--secondary), transparent);
  top: 60%;
  right: 20%;
  animation-delay: -5s;
}

.orb:nth-child(3) {
  width: 100px;
  height: 100px;
  background: radial-gradient(circle, var(--accent), transparent);
  bottom: 20%;
  left: 30%;
  animation-delay: -10s;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-30px) rotate(120deg); }
  66% { transform: translateY(20px) rotate(240deg); }
}

.notification-container {
  position: fixed;
  top: 2rem;
  right: 2rem;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  pointer-events: none;
}

.notification {
  background: var(--glass);
  backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 1rem;
  padding: 1.5rem 2rem;
  color: white;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  transform: translateX(400px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: auto;
  position: relative;
  overflow: hidden;
  max-width: 400px;
  min-width: 300px;
}

.notification.show {
  transform: translateX(0);
  opacity: 1;
}

.notification::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
}

.notification.success::before { background: linear-gradient(90deg, var(--success), #059669); }
.notification.error::before { background: linear-gradient(90deg, var(--danger), #dc2626); }
.notification.warning::before { background: linear-gradient(90deg, var(--warning), #d97706); }
.notification.info::before { background: linear-gradient(90deg, var(--info), #2563eb); }

.notification-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.notification-title {
  font-weight: 700;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.notification-close {
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  font-size: 1.2rem;
  padding: 0.25rem;
  border-radius: 0.5rem;
  transition: all 0.2s ease;
}

.notification-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.notification-message {
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.5;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.show {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--glass);
  backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 2rem;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  transform: scale(0.8) translateY(50px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.show .modal-content {
  transform: scale(1) translateY(0);
}

.modal-header {
  padding: 2rem 2rem 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-header h3 {
  font-size: 1.5rem;
  font-weight: 700;
  color: white;
  margin: 0;
}

.modal-close {
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  font-size: 1.5rem;
  padding: 0.5rem;
  border-radius: 0.5rem;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.modal-body {
  padding: 1.5rem 2rem;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.6;
}

.modal-footer {
  padding: 1rem 2rem 2rem;
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.modal-input {
  width: 100%;
  padding: 1rem 1.5rem;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  backdrop-filter: blur(10px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: inherit;
  margin-top: 1rem;
}

.modal-input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.modal-input:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
  position: relative;
}

.header {
  text-align: center;
  margin-bottom: 2rem;
  animation: fadeInDown 1s ease-out;
}

.header h1 {
  font-size: clamp(2.5rem, 6vw, 4rem);
  font-weight: 900;
  background: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 50%, #f59e0b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  text-shadow: 0 0 40px rgba(139, 92, 246, 0.5);
  letter-spacing: -2px;
}

.header p {
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.8);
  font-weight: 400;
}

.reset-buttons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 2rem;
}

.dual-wheel-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

.wheel-section-container {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.wheel-section-container h2 {
  text-align: center;
  color: var(--text);
  font-size: 1.8rem;
  font-weight: 700;
  margin: 0;
  padding: 1rem;
  background: var(--glass);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 1rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.wheel-container {
  background: var(--glass);
  backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 2rem;
  padding: 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
}

.wheel-content {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.wheel-svg-container {
  position: relative;
  display: inline-block;
}

.wheel-svg {
  width: 350px;
  height: 350px;
  filter: drop-shadow(0 30px 60px rgba(0, 0, 0, 0.4));
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.wheel-pointer {
  position: absolute;
  top: 50%;
  right: -25px;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 35px solid var(--danger);
  border-top: 30px solid transparent;
  border-bottom: 30px solid transparent;
  z-index: 10;
  filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.5));
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: translateY(-50%) scale(1); }
  50% { transform: translateY(-50%) scale(1.15); }
}

.spin-button {
  background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
  color: white;
  border: none;
  padding: 1rem 2.5rem;
  font-size: 1.2rem;
  font-weight: 700;
  border-radius: 50px;
  cursor: pointer;
  margin-top: 1.5rem;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.spin-button:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 45px rgba(239, 68, 68, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.2) inset;
}

.spin-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.result-display {
  background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
  color: white;
  padding: 2rem;
  border-radius: 1.5rem;
  margin-top: 1.5rem;
  text-align: center;
  transform: scale(0);
  transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  box-shadow: 0 30px 60px rgba(16, 185, 129, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
}

.result-display.show {
  transform: scale(1);
}

.result-display h4 {
  margin-bottom: 1rem;
  font-size: 1.5rem;
  font-weight: 700;
}

.result-display .winner {
  font-size: 2rem;
  font-weight: 900;
  text-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

.controls-panel {
  background: var(--glass);
  backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 2rem;
  padding: 2rem;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
}

.controls-panel h3 {
  font-size: 1.5rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1.5rem;
  text-align: center;
}

.input-group {
  margin-bottom: 1.5rem;
}

.input-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  font-size: 0.9rem;
}

.input-group input {
  width: 100%;
  padding: 1rem 1.2rem;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  backdrop-filter: blur(10px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: inherit;
}

.input-group input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.input-group input:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
}

.btn {
  padding: 0.9rem 1.5rem;
  border: none;
  border-radius: 1rem;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 600;
  font-family: inherit;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  margin: 0.3rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  width: calc(100% - 0.6rem);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 35px rgba(139, 92, 246, 0.6);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  color: white;
  box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
}

.btn-danger:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 35px rgba(239, 68, 68, 0.6);
}

.btn-small {
  padding: 0.6rem 1rem;
  font-size: 0.85rem;
  width: auto;
  margin: 0.2rem;
}

.auto-controls {
  margin-bottom: 1rem;
}

.file-input {
  margin-bottom: 1rem;
}

.export-section {
  border-top: 2px solid rgba(255, 255, 255, 0.1);
  padding-top: 1.5rem;
  margin-top: 1.5rem;
}

.export-section h4 {
  color: white;
  margin-bottom: 1rem;
  font-weight: 700;
  font-size: 1.1rem;
}

.names-list {
  max-height: 300px;
  overflow-y: auto;
  margin-top: 1.5rem;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
}

.names-list::-webkit-scrollbar {
  width: 8px;
}

.names-list::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
}

.names-list::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 1rem;
}

.name-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.name-item:hover {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 0.8rem;
  padding: 1rem 0.8rem;
  margin: 0 -0.8rem;
}

.name-item:last-child {
  border-bottom: none;
}

.name-text {
  flex: 1;
  margin-right: 0.8rem;
  font-weight: 600;
  color: white;
  font-size: 1rem;
}

.name-actions {
  display: flex;
  gap: 0.5rem;
}

.empty-state {
  text-align: center;
  padding: 3rem 1.5rem;
  color: rgba(255, 255, 255, 0.6);
}

.empty-state .emoji {
  font-size: 4rem;
  margin-bottom: 1.5rem;
}

.empty-state p {
  font-size: 1.1rem;
  line-height: 1.6;
}

.history-section {
  background: var(--glass);
  backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 2rem;
  padding: 2rem;
  margin-top: 2rem;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
}

.history-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.history-header h2 {
  font-size: 2rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.history-buttons {
  display: flex;
  gap: 1rem;
}

.history-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 0.5rem;
}

.history-list::-webkit-scrollbar {
  width: 8px;
}

.history-list::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
}

.history-list::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 1rem;
}

.history-item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  padding: 1.5rem;
  transition: all 0.3s ease;
}

.history-item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(5px);
}

.history-item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.history-item-number {
  font-size: 1.2rem;
  font-weight: 800;
  color: var(--accent);
}

.history-item-time {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.6);
}

.history-item-result {
  display: flex;
  gap: 2rem;
  align-items: center;
}

.history-result-box {
  flex: 1;
}

.history-result-label {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.history-result-value {
  font-size: 1.3rem;
  font-weight: 700;
  color: white;
}

.wheel-section {
  stroke: rgba(255, 255, 255, 0.8);
  stroke-width: 3;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.wheel-section.winner {
  stroke: var(--accent);
  stroke-width: 8;
  filter: brightness(1.3) drop-shadow(0 0 30px rgba(245, 158, 11, 0.8));
}

.wheel-text {
  font-size: 14px;
  font-weight: 700;
  fill: white;
  text-anchor: middle;
  dominant-baseline: middle;
  text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.8);
  pointer-events: none;
}

.spinning {
  animation: spin 4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  transform-origin: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(var(--spin-rotation)); }
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-50px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 1024px) {
  .dual-wheel-layout { grid-template-columns: 1fr; }
  .wheel-svg { width: 300px; height: 300px; }
}

@media (max-width: 768px) {
  .header h1 { font-size: 2rem; }
  .wheel-svg { width: 280px; height: 280px; }
  .reset-buttons { flex-direction: column; }
  .history-buttons { flex-direction: column; }
}
    </style>
  </head>
  <body>
    <div class="floating-orbs">
      <div class="orb"></div>
      <div class="orb"></div>
      <div class="orb"></div>
    </div>
    <div class="notification-container" id="notificationContainer"></div>
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal-content" id="modalContent">
        <div class="modal-header">
          <h3 id="modalTitle"></h3>
          <button class="modal-close" id="modalClose">‚úï</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer" id="modalFooter"></div>
      </div>
    </div>

    <div class="container">
      <div class="header">
        <h1>Ruota Nomi & Nazioni</h1>
        <p>Gira due ruote indipendenti per estrarre un nome e una nazione.</p>
      </div>

      <div class="reset-buttons">
        <button class="btn btn-danger" id="resetAllBtn">‚ö†Ô∏è Resetta Tutto</button>
        <button class="btn btn-primary" id="spinBothBtn">üéâ Gira NOME & NAZIONE</button>
      </div>

      <div class="dual-wheel-layout">
        <div class="wheel-section-container">
          <h2>üë§ Ruota dei Nomi</h2>
          <div class="wheel-container">
            <div class="wheel-content">
              <div class="wheel-svg-container">
                <svg class="wheel-svg" id="wheelSvg1" viewBox="0 0 400 400"></svg>
                <div class="wheel-pointer"></div>
              </div>
              <button class="spin-button" id="spinButton1">üé≤ Gira la Ruota dei Nomi!</button>
              <div class="result-display" id="resultDisplay1">
                <h4>üèÜ Nome Estratto:</h4>
                <div class="winner" id="winnerName1"></div>
              </div>
            </div>
          </div>
          <div class="controls-panel">
            <h3>‚öôÔ∏è Controlli Ruota Nomi</h3>
            <div class="input-group">
              <label for="nameInput1">Nome:</label>
              <input type="text" id="nameInput1" placeholder="Inserisci un nome..." />
            </div>
            <button class="btn btn-primary" id="addNameBtn1">‚ûï Aggiungi Nome</button>
            <div class="auto-controls">
              <div class="input-group">
                <label for="autoCount1">Numero nomi da generare:</label>
                <input type="number" id="autoCount1" min="2" max="50" value="8" />
              </div>
              <button class="btn btn-primary" id="generateCompleteBtn1">üë§ Genera Nomi Automaticamente</button>
            </div>
            <div class="file-input">
              <button class="btn btn-primary" id="loadFileBtn1">üìÇ Carica Nomi</button>
              <input type="file" id="fileInput1" accept=".txt,.json" style="display: none" />
            </div>
            <div class="export-section">
              <h4>üíæ Esporta Nomi</h4>
              <button class="btn btn-secondary" id="exportTxtBtn1">üìÑ Scarica TXT</button>
              <button class="btn btn-secondary" id="exportJsonBtn1">üìã Scarica JSON</button>
            </div>
            <button class="btn btn-danger" id="clearAllBtn1">üóëÔ∏è Cancella Tutto</button>
            <div class="names-list" id="namesList1">
              <div class="empty-state">
                <div class="emoji">üë§</div>
                <p>Nessun nome ancora.<br />Aggiungi alcuni nomi per iniziare!</p>
              </div>
            </div>
          </div>
        </div>

        <div class="wheel-section-container">
          <h2>üåç Ruota delle Nazioni</h2>
          <div class="wheel-container">
            <div class="wheel-content">
              <div class="wheel-svg-container">
                <svg class="wheel-svg" id="wheelSvg2" viewBox="0 0 400 400"></svg>
                <div class="wheel-pointer"></div>
              </div>
              <button class="spin-button" id="spinButton2">üé≤ Gira la Ruota delle Nazioni!</button>
              <div class="result-display" id="resultDisplay2">
                <h4>üèÜ Nazione Estratta:</h4>
                <div class="winner" id="winnerName2"></div>
              </div>
            </div>
          </div>
          <div class="controls-panel">
            <h3>‚öôÔ∏è Controlli Ruota Nazioni</h3>
            <div class="input-group">
              <label for="nationInput2">Nazione:</label>
              <input type="text" id="nationInput2" placeholder="Inserisci una nazione..." />
            </div>
            <button class="btn btn-primary" id="addNameBtn2">‚ûï Aggiungi Nazione</button>
            <div class="auto-controls">
              <div class="input-group">
                <label for="autoCount2">Numero nazioni da generare:</label>
                <input type="number" id="autoCount2" min="2" max="50" value="8" />
              </div>
              <button class="btn btn-primary" id="generateCompleteBtn2">üåç Genera Nazioni Automaticamente</button>
            </div>
            <div class="file-input">
              <button class="btn btn-primary" id="loadFileBtn2">üìÇ Carica Nazioni</button>
              <input type="file" id="fileInput2" accept=".txt,.json" style="display: none" />
            </div>
            <div class="export-section">
              <h4>üíæ Esporta Nazioni</h4>
              <button class="btn btn-secondary" id="exportTxtBtn2">üìÑ Scarica TXT</button>
              <button class="btn btn-secondary" id="exportJsonBtn2">üìã Scarica JSON</button>
            </div>
            <button class="btn btn-danger" id="clearAllBtn2">üóëÔ∏è Cancella Tutto</button>
            <div class="names-list" id="namesList2">
              <div class="empty-state">
                <div class="emoji">üåç</div>
                <p>Nessuna nazione ancora.<br />Aggiungi alcune nazioni per iniziare!</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="history-section">
        <div class="history-header">
          <h2>üìú Cronologia Estrazioni</h2>
          <div class="history-buttons">
            <button class="btn btn-secondary btn-small" id="shareHistoryBtn">üîó Condividi Cronologia</button>
            <button class="btn btn-danger btn-small" id="resetHistoryBtn">üîÑ Reset Cronologia</button>
          </div>
        </div>
        <div class="history-list" id="historyList">
          <div class="empty-state">
            <div class="emoji">üìú</div>
            <p>Nessuna estrazione ancora.<br />Gira le ruote per iniziare!</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Utility Systems
      class NotificationSystem {
        constructor() {
          this.container = document.getElementById("notificationContainer");
          this.notifications = [];
        }

        show(message, type = "info", title = "Notifica", duration = 4000) {
          const notification = document.createElement("div");
          notification.className = `notification ${type}`;
          
          const icon = {
            success: "‚úÖ",
            error: "‚ùå",
            warning: "‚ö†Ô∏è",
            info: "‚ÑπÔ∏è"
          }[type] || "üîî";

          notification.innerHTML = `
            <div class="notification-header">
              <div class="notification-title">${icon} ${title}</div>
              <button class="notification-close">‚úï</button>
            </div>
            <div class="notification-message">${message}</div>
          `;

          const closeBtn = notification.querySelector(".notification-close");
          closeBtn.addEventListener("click", () => this.hide(notification));

          this.container.appendChild(notification);
          this.notifications.push(notification);

          // Animate in
          setTimeout(() => {
            notification.classList.add("show");
          }, 10);

          // Animate out and remove
          setTimeout(() => {
            this.hide(notification);
          }, duration);
        }

        hide(notification) {
          notification.classList.remove("show");
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
            this.notifications = this.notifications.filter((n) => n !== notification);
          }, 400);
        }
      }

      // Modal System
      class ModalSystem {
        constructor() {
          this.overlay = document.getElementById("modalOverlay");
          this.content = document.getElementById("modalContent");
          this.title = document.getElementById("modalTitle");
          this.body = document.getElementById("modalBody");
          this.footer = document.getElementById("modalFooter");
          this.closeBtn = document.getElementById("modalClose");
          this.bindEvents();
        }

        bindEvents() {
          this.closeBtn.addEventListener("click", () => this.hide());
          this.overlay.addEventListener("click", (e) => {
            if (e.target === this.overlay) this.hide();
          });
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && this.overlay.classList.contains("show")) {
              this.hide();
            }
          });
        }

        show(options = {}) {
          const { title = "", body = "", buttons = [] } = options;
          this.title.textContent = title;
          this.body.innerHTML = body;
          this.footer.innerHTML = "";
          buttons.forEach((button) => {
            const btn = document.createElement("button");
            btn.className = `btn ${button.class || "btn-secondary"}`;
            btn.textContent = button.text;
            btn.addEventListener("click", () => {
              if (button.action) button.action();
              if (button.close !== false) this.hide();
            });
            this.footer.appendChild(btn);
          });
          this.overlay.classList.add("show");
          document.body.style.overflow = "hidden";
        }

        hide() {
          this.overlay.classList.remove("show");
          document.body.style.overflow = "";
        }

        confirm(message, title = "Conferma") {
          return new Promise((resolve) => {
            this.show({
              title,
              body: message,
              buttons: [
                {
                  text: "Annulla",
                  class: "btn-secondary",
                  action: () => resolve(false),
                },
                {
                  text: "Conferma",
                  class: "btn-danger",
                  action: () => resolve(true),
                },
              ],
            });
          });
        }

        prompt(message, defaultValue = "", title = "Inserisci") {
          return new Promise((resolve) => {
            const inputId = "modal-prompt-input";
            this.show({
              title,
              body: `<p>${message}</p><input type="text" id="${inputId}" class="modal-input" value="${defaultValue}" placeholder="Inserisci valore...">`,
              buttons: [
                {
                  text: "Annulla",
                  class: "btn-secondary",
                  action: () => resolve(null),
                },
                {
                  text: "Conferma",
                  class: "btn-primary",
                  action: () => {
                    const input = document.getElementById(inputId);
                    resolve(input.value.trim() || null);
                  },
                },
              ],
            });
            setTimeout(() => {
              const input = document.getElementById(inputId);
              input.focus();
              input.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                  resolve(input.value.trim() || null);
                  this.hide();
                }
              });
            }, 100);
          });
        }
      }

      const notificationSystem = new NotificationSystem();
      const modalSystem = new ModalSystem();

      // Main Logic
      class DualWheelOfFortune {
        constructor() {
          this.wheel1Names = this.loadFromStorage("wheel1Names", []); // All names
          this.wheel2Names = this.loadFromStorage("wheel2Names", []); // All nations
          this.availableWheel1Names = this.loadFromStorage(
            "availableWheel1Names",
            [...this.wheel1Names]
          ); // Names not yet extracted
          this.availableWheel2Names = this.loadFromStorage(
            "availableWheel2Names",
            [...this.wheel2Names]
          ); // Nations not yet extracted
          this.history = this.loadFromStorage("history", []); // Extraction history
          this.isSpinning1 = false;
          this.isSpinning2 = false;

          this.init();
          this.bindEvents();
        }

        init() {
          this.updateWheel(1);
          this.updateWheel(2);
          this.updateNamesList(1);
          this.updateNamesList(2);
          this.updateHistory();
        }

        loadFromStorage(key, defaultValue) {
          try {
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : defaultValue;
          } catch (e) {
            console.error(`Error loading ${key} from storage:`, e);
            return defaultValue;
          }
        }

        saveToStorage() {
          try {
            localStorage.setItem("wheel1Names", JSON.stringify(this.wheel1Names));
            localStorage.setItem("wheel2Names", JSON.stringify(this.wheel2Names));
            localStorage.setItem(
              "availableWheel1Names",
              JSON.stringify(this.availableWheel1Names)
            );
            localStorage.setItem(
              "availableWheel2Names",
              JSON.stringify(this.availableWheel2Names)
            );
            localStorage.setItem("history", JSON.stringify(this.history));
          } catch (e) {
            console.error("Error saving to storage:", e);
          }
        }

        bindEvents() {
          // Wheel 1 events
          document.getElementById("addNameBtn1").addEventListener("click", () => this.addItem(1));
          document.getElementById("nameInput1").addEventListener("keypress", (e) => {
            if (e.key === "Enter") this.addItem(1);
          });
          document.getElementById("generateCompleteBtn1").addEventListener("click", () => this.generateAuto(1));
          document.getElementById("spinButton1").addEventListener("click", () => this.spinWheel(1));
          document.getElementById("clearAllBtn1").addEventListener("click", () => this.clearWheel(1));
          document.getElementById("fileInput1").addEventListener("change", (e) => this.loadFile(e, 1));
          document.getElementById("loadFileBtn1").addEventListener("click", () => { document.getElementById("fileInput1").click(); });
          document.getElementById("exportTxtBtn1").addEventListener("click", () => this.exportTxt(1));
          document.getElementById("exportJsonBtn1").addEventListener("click", () => this.exportJson(1));

          // Wheel 2 events
          document.getElementById("addNameBtn2").addEventListener("click", () => this.addItem(2));
          document.getElementById("nationInput2").addEventListener("keypress", (e) => {
            if (e.key === "Enter") this.addItem(2);
          });
          document.getElementById("generateCompleteBtn2").addEventListener("click", () => this.generateAuto(2));
          document.getElementById("spinButton2").addEventListener("click", () => this.spinWheel(2));
          document.getElementById("clearAllBtn2").addEventListener("click", () => this.clearWheel(2));
          document.getElementById("fileInput2").addEventListener("change", (e) => this.loadFile(e, 2));
          document.getElementById("loadFileBtn2").addEventListener("click", () => { document.getElementById("fileInput2").click(); });
          document.getElementById("exportTxtBtn2").addEventListener("click", () => this.exportTxt(2));
          document.getElementById("exportJsonBtn2").addEventListener("click", () => this.exportJson(2));

          // History and reset events
          document.getElementById("resetHistoryBtn").addEventListener("click", () => this.resetHistory());
          document.getElementById("resetAllBtn").addEventListener("click", () => this.resetAll());
          document.getElementById("shareHistoryBtn").addEventListener("click", () => this.shareHistory());

          // NEW COMBINED SPIN EVENT
          document.getElementById("spinBothBtn").addEventListener("click", () => this.spinCombined());
        }

        generateAuto(wheelNumber) {
          const count = Number.parseInt(document.getElementById(`autoCount${wheelNumber}`).value) || 8;

          if (wheelNumber === 1) {
            const autoNames = ["Marco", "Giulia", "Alessandro", "Francesca", "Luca", "Valentina", "Matteo", "Chiara", "Andrea", "Martina", "Davide", "Sara", "Simone", "Elena", "Federico", "Alessia", "Lorenzo", "Giorgia", "Riccardo", "Ilaria", "Nicola", "Federica", "Stefano", "Silvia", "Antonio", "Roberta", "Giuseppe", "Paola", "Francesco", "Laura", "Giovanni", "Anna", "Roberto", "Maria", "Paolo", "Cristina", "Michele", "Daniela", "Fabio", "Monica", "Daniele", "Serena", "Emanuele", "Claudia", "Vincenzo", "Emanuela", "Salvatore", "Manuela", "Massimo", "Patrizia"];
            const shuffledNames = autoNames.sort(() => 0.5 - Math.random());
            this.wheel1Names = shuffledNames.slice(0, Math.min(count, 50));
            this.availableWheel1Names = [...this.wheel1Names];
          } else {
            const autoNations = ["Italia", "Francia", "Germania", "Spagna", "Regno Unito", "USA", "Canada", "Brasile", "Argentina", "Cina", "Giappone", "Australia", "India", "Russia", "Messico", "Egitto", "Sudafrica", "Svezia", "Norvegia", "Portogallo", "Belgio", "Svizzera", "Grecia", "Polonia", "Turchia"];
            const shuffledNations = autoNations.sort(() => 0.5 - Math.random());
            this.wheel2Names = shuffledNations.slice(0, Math.min(count, 25));
            this.availableWheel2Names = [...this.wheel2Names];
          }

          this.updateWheel(wheelNumber);
          this.updateNamesList(wheelNumber);
          this.saveToStorage();
          this.hideResult(wheelNumber);
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";
          notificationSystem.show(`${wheelName.charAt(0).toUpperCase() + wheelName.slice(1)} generati automaticamente!`, "info");
        }

        getColorPalette(count) {
          const colors = [];
          const hueStep = 360 / count;
          for (let i = 0; i < count; i++) {
            colors.push(`hsl(${i * hueStep}, 70%, 60%)`);
          }
          return colors;
        }

        async addItem(wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          if (items.length >= 100) {
            const itemType = wheelNumber === 1 ? "nomi" : "nazioni";
            notificationSystem.show(`Puoi inserire al massimo 100 ${itemType}!`, "warning");
            return;
          }

          let inputValue, itemType, inputId;
          if (wheelNumber === 1) {
            inputId = "nameInput1";
            itemType = "nome";
            inputValue = document.getElementById(inputId).value.trim();
          } else {
            inputId = "nationInput2";
            itemType = "nazione";
            inputValue = document.getElementById(inputId).value.trim();
          }

          if (!inputValue) {
            notificationSystem.show(`Inserisci un ${itemType} valido`, "warning");
            return;
          }

          if (items.includes(inputValue)) {
            notificationSystem.show(`Questo ${itemType} √® gi√† presente nella lista`, "warning");
            return;
          }

          items.push(inputValue);
          document.getElementById(inputId).value = "";

          if (wheelNumber === 1) {
            this.wheel1Names = items;
            this.availableWheel1Names.push(inputValue);
          } else {
            this.wheel2Names = items;
            this.availableWheel2Names.push(inputValue);
          }

          this.updateWheel(wheelNumber);
          this.updateNamesList(wheelNumber);
          this.saveToStorage();
          this.hideResult(wheelNumber);
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";
          notificationSystem.show(`"${inputValue}" aggiunto alla ruota ${wheelName}!`, "success");
        }

        async editName(index, wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const isSpinning = wheelNumber === 1 ? this.isSpinning1 : this.isSpinning2;
          if (isSpinning) {
            const itemType = wheelNumber === 1 ? "nomi" : "nazioni";
            notificationSystem.show(`Non puoi modificare i ${itemType} mentre la ruota gira`, "warning");
            return;
          }

          const currentItem = items[index];
          const itemType = wheelNumber === 1 ? "nome" : "nazione";
          const newItem = await modalSystem.prompt(
            `Modifica ${itemType}:`,
            currentItem,
            `Modifica ${itemType}`
          );

          if (newItem === null) return;
          if (newItem === currentItem) return;

          if (items.includes(newItem)) {
            notificationSystem.show(`Questo ${itemType} √® gi√† presente nella lista`, "warning");
            return;
          }

          // Update main list
          items[index] = newItem;

          // Update available list
          const availableItems = wheelNumber === 1 ? this.availableWheel1Names : this.availableWheel2Names;
          const availIndex = availableItems.indexOf(currentItem);
          if (availIndex !== -1) {
            availableItems[availIndex] = newItem;
          }

          if (wheelNumber === 1) {
            this.wheel1Names = items;
            this.availableWheel1Names = availableItems;
          } else {
            this.wheel2Names = items;
            this.availableWheel2Names = availableItems;
          }

          this.updateWheel(wheelNumber);
          this.updateNamesList(wheelNumber);
          this.saveToStorage();
          this.hideResult(wheelNumber);
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";
          notificationSystem.show(`"${currentItem}" modificato in "${newItem}" nella ruota ${wheelName}`, "success");
        }

        async deleteName(index, wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const isSpinning = wheelNumber === 1 ? this.isSpinning1 : this.isSpinning2;
          if (isSpinning) {
            const itemType = wheelNumber === 1 ? "nomi" : "nazioni";
            notificationSystem.show(`Non puoi eliminare ${itemType} mentre la ruota sta girando`, "warning");
            return;
          }

          const item = items[index];
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";
          const itemType = wheelNumber === 1 ? "nome" : "nazione";

          const confirmed = await modalSystem.confirm(
            `Sei sicuro di voler eliminare "${item}" dalla ruota ${wheelName}?`,
            `Elimina ${itemType}`
          );

          if (confirmed) {
            items.splice(index, 1);

            if (wheelNumber === 1) {
              const availIndex = this.availableWheel1Names.indexOf(item);
              if (availIndex !== -1) {
                this.availableWheel1Names.splice(availIndex, 1);
              }
            } else {
              const availIndex = this.availableWheel2Names.indexOf(item);
              if (availIndex !== -1) {
                this.availableWheel2Names.splice(availIndex, 1);
              }
            }

            this.updateWheel(wheelNumber);
            this.updateNamesList(wheelNumber);
            this.saveToStorage();
            this.hideResult(wheelNumber);
            notificationSystem.show(`"${item}" eliminato dalla ruota ${wheelName}`, "success");
          }
        }

        updateWheel(wheelNumber) {
          const svg = document.getElementById(`wheelSvg${wheelNumber}`);
          const items = wheelNumber === 1 ? this.availableWheel1Names : this.availableWheel2Names;
          svg.innerHTML = "";

          if (items.length === 0) {
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", "200");
            circle.setAttribute("cy", "200");
            circle.setAttribute("r", "180");
            circle.setAttribute("fill", "#e1e5e9");
            circle.setAttribute("stroke", "#ccc");
            circle.setAttribute("stroke-width", "3");
            svg.appendChild(circle);

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", "200");
            text.setAttribute("y", "200");
            text.setAttribute("text-anchor", "middle");
            text.setAttribute("dominant-baseline", "middle");
            text.setAttribute("fill", "#999");
            text.setAttribute("font-size", "18");
            text.setAttribute("font-weight", "bold");
            const emptyText = wheelNumber === 1 ? "Aggiungi nomi" : "Aggiungi nazioni";
            text.textContent = emptyText;
            svg.appendChild(text);
            return;
          }

          const colors = this.getColorPalette(items.length);
          const totalItems = items.length;
          const arcDegrees = 360 / totalItems;
          const center = 200;
          const radius = 180;

          items.forEach((item, index) => {
            const startAngle = index * arcDegrees;
            const endAngle = (index + 1) * arcDegrees;

            // Pie slice path
            const startX = center + radius * Math.cos((Math.PI / 180) * (startAngle - 90));
            const startY = center + radius * Math.sin((Math.PI / 180) * (startAngle - 90));
            const endX = center + radius * Math.cos((Math.PI / 180) * (endAngle - 90));
            const endY = center + radius * Math.sin((Math.PI / 180) * (endAngle - 90));
            const largeArcFlag = arcDegrees > 180 ? 1 : 0;

            const pathData = [
              `M ${center},${center}`,
              `L ${startX},${startY}`,
              `A ${radius},${radius} 0 ${largeArcFlag} 1 ${endX},${endY}`,
              "Z",
            ].join(" ");

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", pathData);
            path.setAttribute("fill", colors[index]);
            path.classList.add("wheel-section");
            svg.appendChild(path);

            // Text
            const textAngle = startAngle + arcDegrees / 2;
            const textRadius = radius * 0.7;
            const textX = center + textRadius * Math.cos((Math.PI / 180) * (textAngle - 90));
            const textY = center + textRadius * Math.sin((Math.PI / 180) * (textAngle - 90));

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", textX);
            text.setAttribute("y", textY);
            text.setAttribute("text-anchor", "middle");
            text.setAttribute("dominant-baseline", "middle");
            text.setAttribute("fill", "white");
            text.setAttribute("font-size", Math.min(14, 140 / items.length + 8));
            text.setAttribute("font-weight", "bold");
            text.setAttribute("paint-order", "stroke");
            text.setAttribute("stroke", "black");
            text.setAttribute("stroke-width", "1");
            text.setAttribute("transform", `rotate(${textAngle}, ${textX}, ${textY})`);
            text.textContent = item.length > 12 ? item.substring(0, 12) + "..." : item;
            text.classList.add("wheel-text");
            svg.appendChild(text);
          });
        }

        updateNamesList(wheelNumber) {
          const namesList = document.getElementById(`namesList${wheelNumber}`);
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;

          if (items.length === 0) {
            const emptyText = wheelNumber === 1 ? '<div class="empty-state"><div class="emoji">üë§</div><p>Nessun nome ancora.<br>Aggiungi alcuni nomi per iniziare!</p></div>' : '<div class="empty-state"><div class="emoji">üåç</div><p>Nessuna nazione ancora.<br>Aggiungi alcune nazioni per iniziare!</p></div>';
            namesList.innerHTML = emptyText;
            return;
          }

          namesList.innerHTML = items
            .map(
              (item, index) => `
                <div class="name-item">
                  <span class="name-text">${item}</span>
                  <div class="name-actions">
                    <button class="btn btn-secondary btn-small" onclick="dualWheel.editName(${index}, ${wheelNumber})" title="Modifica">‚úèÔ∏è</button>
                    <button class="btn btn-danger btn-small" onclick="dualWheel.deleteName(${index}, ${wheelNumber})" title="Elimina">üóëÔ∏è</button>
                  </div>
                </div>
              `
            )
            .join("");
        }
        
        // NEW METHOD FOR COMBINED SPIN
        async spinCombined() {
          const items1 = this.availableWheel1Names;
          const items2 = this.availableWheel2Names;
          const spinButton1 = document.getElementById("spinButton1");
          const spinButton2 = document.getElementById("spinButton2");
          const spinBothBtn = document.getElementById("spinBothBtn");

          if (items1.length === 0 || items2.length === 0) {
            notificationSystem.show("Assicurati di avere almeno un nome e una nazione disponibili per l'estrazione combinata!", "warning");
            return;
          }
          
          if (this.isSpinning1 || this.isSpinning2) {
            notificationSystem.show("Una ruota √® gi√† in rotazione! Attendi la fine dell'estrazione.", "warning");
            return;
          }

          // Temporarily disable buttons
          spinButton1.disabled = true;
          spinButton2.disabled = true;
          spinBothBtn.disabled = true;
          
          this.isSpinning1 = true;
          this.isSpinning2 = true; 
          this.hideResult(1);
          this.hideResult(2);

          // 1. Spin Wheel 1 (Name) - Animation setup
          const svg1 = document.getElementById(`wheelSvg1`);
          const randomIndex1 = Math.floor(Math.random() * items1.length);
          const winner1 = items1[randomIndex1];
          const totalRotation1 = 360 * 10 + (360 / items1.length) * randomIndex1;
          svg1.style.setProperty("--spin-rotation", `-${totalRotation1}deg`);
          svg1.classList.add("spinning");
          
          // 2. Spin Wheel 2 (Nation) - Animation setup
          const svg2 = document.getElementById(`wheelSvg2`);
          const randomIndex2 = Math.floor(Math.random() * items2.length);
          const winner2 = items2[randomIndex2];
          const totalRotation2 = 360 * 10 + (360 / items2.length) * randomIndex2;
          svg2.style.setProperty("--spin-rotation", `-${totalRotation2}deg`);
          svg2.classList.add("spinning");

          // 3. Wait for the spin to finish
          await new Promise(resolve => setTimeout(resolve, 4000));
          
          // 4. Cleanup and Result
          svg1.classList.remove("spinning");
          svg2.classList.remove("spinning");
          
          this.isSpinning1 = false;
          this.isSpinning2 = false;

          // Remove winners from available lists
          items1.splice(randomIndex1, 1);
          items2.splice(randomIndex2, 1);
          
          // Update wheels and lists
          this.updateWheel(1);
          this.updateWheel(2);
          this.updateNamesList(1);
          this.updateNamesList(2);

          // Show results
          this.showResult(`${winner1}`, 1); 
          this.showResult(`${winner2}`, 2); 

          // Add to history (wheelNumber = 0 for combined)
          this.addToHistory(0, winner1, winner2); 

          this.saveToStorage();

          // Re-enable buttons
          spinButton1.disabled = false;
          spinButton2.disabled = false;
          spinBothBtn.disabled = false;

          // Notification
          notificationSystem.show(`üéâ Estrazione Combinata: ${winner1} e ${winner2}!`, "success", "Abbiamo una Coppia!", 8000);
        }

        spinWheel(wheelNumber) {
          const items = wheelNumber === 1 ? this.availableWheel1Names : this.availableWheel2Names;
          const isSpinning = wheelNumber === 1 ? this.isSpinning1 : this.isSpinning2;
          const spinButton = document.getElementById(`spinButton${wheelNumber}`);
          const resultType = wheelNumber === 1 ? "nome" : "nazione";
          const svg = document.getElementById(`wheelSvg${wheelNumber}`);
          
          // Check for availability and spinning state
          if (items.length === 0) {
            notificationSystem.show(`Nessun ${resultType} disponibile per l'estrazione!`, "warning");
            return;
          }
          if (isSpinning) return;

          // Disable buttons (including the combined one, to prevent issues)
          spinButton.disabled = true;
          document.getElementById("spinBothBtn").disabled = true;
          document.getElementById(`spinButton${wheelNumber === 1 ? 2 : 1}`).disabled = true;

          // Select winner and start animation
          const randomIndex = Math.floor(Math.random() * items.length);
          const winner = items[randomIndex];
          const totalRotation = 360 * 10 + (360 / items.length) * randomIndex;
          
          // Reset old winner class
          svg.querySelectorAll('.wheel-section').forEach(path => path.classList.remove('winner'));
          
          // Start spinning
          svg.style.setProperty("--spin-rotation", `-${totalRotation}deg`);
          svg.classList.add("spinning");
          this.hideResult(wheelNumber);
          
          if (wheelNumber === 1) this.isSpinning1 = true;
          if (wheelNumber === 2) this.isSpinning2 = true;

          // End spin after 4 seconds
          setTimeout(() => {
            svg.classList.remove("spinning");
            
            // Highlight winner section (use next tick to ensure rotation finished)
            setTimeout(() => {
              svg.querySelectorAll('.wheel-section')[randomIndex].classList.add('winner');
            }, 50);

            // Remove winner from available list
            items.splice(randomIndex, 1);

            if (wheelNumber === 1) this.isSpinning1 = false;
            if (wheelNumber === 2) this.isSpinning2 = false;

            // Re-enable buttons
            spinButton.disabled = false;
            document.getElementById("spinBothBtn").disabled = false;
            document.getElementById(`spinButton${wheelNumber === 1 ? 2 : 1}`).disabled = false;

            // Log result and update display
            this.showResult(winner, wheelNumber);
            this.addToHistory(wheelNumber, winner);
            notificationSystem.show(`üéâ Il ${resultType} estratto √®: ${winner}!`, "success", "Abbiamo un vincitore!", 8000);

            // Update wheel to show remaining items
            this.updateWheel(wheelNumber);
            this.saveToStorage();
          }, 4000);
        }

        addToHistory(wheelNumber, winner, nationWinner = null) { // MODIFIED: added nationWinner
          const timestamp = new Date();
          const historyEntry = {
            id: Date.now(),
            wheelNumber,
            winner,
            nationWinner, // New field
            timestamp: timestamp.toLocaleString('it-IT'),
            wheelType: wheelNumber === 1 ? 'Nomi' : (wheelNumber === 2 ? 'Nazioni' : 'Combinata') // New type for wheelNumber 0
          };
          this.history.unshift(historyEntry);
          this.updateHistory();
          this.saveToStorage();
        }

        updateHistory() { // MODIFIED: logic to handle combined spin (wheelNumber = 0)
          const historyList = document.getElementById("historyList");
          if (this.history.length === 0) {
            historyList.innerHTML = `
              <div class="empty-state">
                <div class="emoji">üìú</div>
                <p>Nessuna estrazione ancora.<br />Gira le ruote per iniziare!</p>
              </div>
            `;
            return;
          }

          historyList.innerHTML = this.history
            .map((entry, index) => {
              // Logic for Combined Spin (wheelNumber = 0)
              if (entry.wheelNumber === 0) {
                return `
                    <div class="history-item">
                        <div class="history-item-header">
                            <div class="history-item-number">#${this.history.length - index}</div>
                            <div class="history-item-time">${entry.timestamp}</div>
                        </div>
                        <div class="history-item-result">
                            <div class="history-result-box">
                                <div class="history-result-label">üë§ Nome Estratto</div>
                                <div class="history-result-value">${entry.winner}</div>
                            </div>
                            <div class="history-result-box">
                                <div class="history-result-label">üåç Nazione Estratta</div>
                                <div class="history-result-value">${entry.nationWinner}</div>
                            </div>
                        </div>
                    </div>
                `;
              } 
              // Original logic for Single Spin (wheelNumber = 1 or 2)
              else {
                return `
                    <div class="history-item">
                        <div class="history-item-header">
                            <div class="history-item-number">#${this.history.length - index}</div>
                            <div class="history-item-time">${entry.timestamp}</div>
                        </div>
                        <div class="history-item-result">
                            <div class="history-result-box">
                                <div class="history-result-label">${entry.wheelType === 'Nomi' ? 'üë§' : 'üåç'} ${entry.wheelType}</div>
                                <div class="history-result-value">${entry.winner}</div>
                            </div>
                        </div>
                    </div>
                `;
              }
            })
            .join("");
        }

        async resetHistory() {
          const confirmed = await modalSystem.confirm(
            "Sei sicuro di voler resettare la cronologia? Questo ripristiner√† anche tutti i nomi e le nazioni disponibili per le estrazioni.",
            "Reset Cronologia"
          );

          if (confirmed) {
            this.history = [];
            this.availableWheel1Names = [...this.wheel1Names];
            this.availableWheel2Names = [...this.wheel2Names];
            this.updateHistory();
            this.updateWheel(1);
            this.updateWheel(2);
            this.saveToStorage();
            notificationSystem.show("Cronologia resettata! Tutti gli elementi sono di nuovo disponibili.", "success");
          }
        }

        async resetAll() {
          const confirmed = await modalSystem.confirm(
            "‚ö†Ô∏è ATTENZIONE: Sei sicuro di voler resettare COMPLETAMENTE l'applicazione? Verranno eliminati TUTTI i nomi, le nazioni e la cronologia.",
            "Reset Completo"
          );

          if (confirmed) {
            this.wheel1Names = [];
            this.availableWheel1Names = [];
            this.wheel2Names = [];
            this.availableWheel2Names = [];
            this.history = [];

            this.updateWheel(1);
            this.updateWheel(2);
            this.updateNamesList(1);
            this.updateNamesList(2);
            this.updateHistory();
            this.saveToStorage();
            this.hideResult(1);
            this.hideResult(2);
            notificationSystem.show("Tutti i dati sono stati cancellati. Inizia ad aggiungere nuovi nomi e nazioni!", "success");
          }
        }

        shareHistory() {
          // Creazione del testo per WhatsApp con formattazione
          let shareText = "*üéâ CRONOLOGIA ESTRAZIONI üéâ*\n";
          shareText += "üé° Ruota Nomi & Nazioni üåç\n\n";

          if (this.history.length === 0) {
              shareText += "_Nessuna estrazione registrata finora._";
          } else {
              this.history.forEach((entry, index) => {
                  const number = this.history.length - index;
                  let result;
                  
                  if (entry.wheelNumber === 0) {
                      // Estrazione Combinata
                      result = `*üë§ Nome:* ${entry.winner}\n*üåç Nazione:* ${entry.nationWinner}`;
                  } else if (entry.wheelNumber === 1) {
                      // Estrazione Nome
                      result = `*üë§ Nome Estratto:* ${entry.winner}`;
                  } else {
                      // Estrazione Nazione
                      result = `*üåç Nazione Estratta:* ${entry.winner}`;
                  }
                  
                  shareText += `---------------------------------\n`;
                  shareText += `*#${number}* - ${entry.wheelType} (${entry.timestamp})\n`;
                  shareText += `${result}\n`; // Il risultato √® gi√† formattato con *...* all'interno del blocco if/else
              });
              shareText += "---------------------------------\n\n";
          }
          
          shareText += "Powered by Ruota Nomi & Nazioni App";
          
          const encodedText = encodeURIComponent(shareText);
          const whatsappUrl = `https://wa.me/?text=${encodedText}`;
          
          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          
          let bodyContent;
          let buttons = [];

          if (isMobile) {
              // Option for mobile: use the native Web Share API or WhatsApp link
              bodyContent = `<p>Tocca il pulsante qui sotto per condividere la cronologia su WhatsApp:</p>`;
              buttons.push({
                  text: "üí¨ Condividi su WhatsApp",
                  class: "btn-success",
                  action: () => {
                      window.open(whatsappUrl, '_blank');
                  },
              });
          } else {
              // Option for desktop: show the text for easy copy-paste and a button to open WhatsApp Web
              bodyContent = `<p>Copia il testo e incollalo su WhatsApp Web o usa il pulsante qui sotto:</p><textarea id="shareTextarea" class="modal-input" rows="10" readonly>${shareText}</textarea>`;
              buttons.push({
                  text: "üìã Copia Testo",
                  class: "btn-primary",
                  action: () => {
                      const textarea = document.getElementById("shareTextarea");
                      textarea.select();
                      document.execCommand("copy");
                      notificationSystem.show("Testo della cronologia copiato negli appunti!", "success", "Copiato!");
                  },
                  close: false
              });
              buttons.push({
                  text: "üåê Condividi su Whatsapp",
                  class: "btn-secondary",
                  action: () => {
                      window.open(whatsappUrl, '_blank');
                  },
              });
          }

          buttons.push({ text: "Chiudi", class: "btn-secondary" });

          modalSystem.show({
              title: "üîó Condividi Cronologia",
              body: bodyContent,
              buttons: buttons,
          });
        }

        async clearWheel(wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";

          const confirmed = await modalSystem.confirm(
            `Sei sicuro di voler cancellare tutti i ${items.length} ${wheelName}?`,
            "Cancella Tutto"
          );

          if (confirmed) {
            if (wheelNumber === 1) {
              this.wheel1Names = [];
              this.availableWheel1Names = [];
            } else {
              this.wheel2Names = [];
              this.availableWheel2Names = [];
            }

            this.updateWheel(wheelNumber);
            this.updateNamesList(wheelNumber);
            this.saveToStorage();
            this.hideResult(wheelNumber);

            notificationSystem.show(`Tutti i ${wheelName} sono stati cancellati`, "success");
          }
        }

        async loadFile(event, wheelNumber) {
          const file = event.target.files[0];
          if (!file) return;

          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";

          const reader = new FileReader();
          reader.onload = async (e) => {
            const content = e.target.result;
            let newItems = [];

            try {
              if (file.name.endsWith(".json")) {
                const data = JSON.parse(content);
                if (Array.isArray(data)) {
                  newItems = data.map((item) => typeof item === "string" ? item : item.name || item.nation || "Item");
                } else {
                  newItems = data.items || data.names || data.nations || [];
                }
              } else {
                newItems = content.split("\n").map((line) => line.trim()).filter((line) => line);
              }
            } catch (error) {
              notificationSystem.show("Errore nella lettura del file. Assicurati che sia un formato JSON o TXT valido.", "error");
              return;
            }

            if (newItems.length === 0) {
              const itemType = wheelNumber === 1 ? "nomi" : "nazioni";
              notificationSystem.show(`Il file non contiene ${itemType} validi`, "warning");
              return;
            }

            const uniqueItems = newItems.filter((newItem) => !items.includes(newItem));
            const remainingSlots = 100 - items.length;
            const itemsToAdd = uniqueItems.slice(0, remainingSlots);

            if (itemsToAdd.length === 0) {
              const itemType = wheelNumber === 1 ? "nomi" : "nazioni";
              notificationSystem.show(`Tutti i ${itemType} nel file sono gi√† presenti nella lista`, "info");
              return;
            }

            if (wheelNumber === 1) {
              this.wheel1Names = [...this.wheel1Names, ...itemsToAdd];
              this.availableWheel1Names = [...this.availableWheel1Names, ...itemsToAdd];
            } else {
              this.wheel2Names = [...this.wheel2Names, ...itemsToAdd];
              this.availableWheel2Names = [...this.availableWheel2Names, ...itemsToAdd];
            }

            this.updateWheel(wheelNumber);
            this.updateNamesList(wheelNumber);
            this.saveToStorage();
            this.hideResult(wheelNumber);
            
            notificationSystem.show(`${itemsToAdd.length} ${wheelName} aggiunti dal file!`, "success");
          };

          reader.readAsText(file);
          event.target.value = null; // Clear input
        }

        exportTxt(wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";

          if (items.length === 0) {
            notificationSystem.show(`Nessun ${wheelName.slice(0, -1)} da esportare`, "warning");
            return;
          }

          const content = items.join("\n");
          const blob = new Blob([content], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `${wheelName}.txt`;
          a.click();
          URL.revokeObjectURL(a.href);
          notificationSystem.show(`${items.length} ${wheelName} esportati in formato TXT`, "success");
        }

        exportJson(wheelNumber) {
          const items = wheelNumber === 1 ? this.wheel1Names : this.wheel2Names;
          const wheelName = wheelNumber === 1 ? "nomi" : "nazioni";

          if (items.length === 0) {
            notificationSystem.show(`Nessun ${wheelName.slice(0, -1)} da esportare`, "warning");
            return;
          }

          const data = {
            [wheelName]: items,
            exported: new Date().toISOString(),
            count: items.length,
            wheel: wheelNumber,
          };
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `${wheelName}.json`;
          a.click();
          URL.revokeObjectURL(a.href);
          notificationSystem.show(`${items.length} ${wheelName} esportati in formato JSON`, "success");
        }

        showResult(winner, wheelNumber) {
          const resultDisplay = document.getElementById(`resultDisplay${wheelNumber}`);
          const winnerName = document.getElementById(`winnerName${wheelNumber}`);
          winnerName.textContent = winner;
          resultDisplay.classList.add("show");
        }

        hideResult(wheelNumber) {
          document.getElementById(`resultDisplay${wheelNumber}`).classList.remove("show");
        }
      }

      // Initialize
      const dualWheel = new DualWheelOfFortune();
      window.dualWheel = dualWheel;

      setTimeout(() => {
        notificationSystem.show(
          "Benvenuto! Aggiungi nomi e nazioni per iniziare, o usa 'Genera Automaticamente'.",
          "info",
          "Ruota Nomi & Nazioni"
        );
      }, 500);
    </script>
  </body>
</html>